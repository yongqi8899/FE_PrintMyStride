import{u as h,a as x,j as t,b as j}from"./index-BlMw5Gxn.js";import{A as u}from"./Alert-CQ4OsiTY.js";import{I as m,r as y,a as b,f as l,b as i}from"./Img-KIURU2Es.js";const p="http://localhost:8080",f=async(e,s)=>{const o={status:"payed",userId:e,products:s.map(a=>({productId:a._id,quantity:a.quantity}))},c=await fetch(`${p}/orders`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!c.ok){const a=await c.json();throw a.error?new Error(a.error):new Error("An Error occured while paying")}const d=await c.json();return localStorage.removeItem("cart"),d},w=({cart:e,setCart:s})=>{const o=h(),{user:c}=x(),d=c._id,a=async()=>{try{const r=await f(d,e);r&&(s(i()),o(`/pay?orderId=${r.newOrder._id}`))}catch(r){console.error("Failed to create order:",r)}};return t.jsx(t.Fragment,{children:e&&t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"table text-center",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Product"}),t.jsx("th",{children:"Product Name"}),t.jsx("th",{children:"Amount"}),t.jsx("th",{children:"Price"})]})}),t.jsxs("tbody",{children:[e.map(r=>t.jsxs("tr",{children:[t.jsx("td",{children:t.jsx("div",{className:"mx-auto h-28 w-28",children:t.jsx("div",{className:"w-full h-full overflow-hidden rounded-full",children:t.jsx(m,{src:r.image,alt:r.title})})})}),t.jsx("td",{children:r.title}),t.jsxs("td",{children:[t.jsx("button",{className:"w-5 mx-2 btn btn-secondary",onClick:()=>s(n=>y(n,r)),children:"-"}),t.jsxs("span",{className:"text-center",children:[" ",r.quantity]}),t.jsx("button",{className:"w-5 mx-2 btn btn-secondary",onClick:()=>s(n=>b(n,r)),children:"+"})]}),t.jsx("td",{children:t.jsx("div",{className:"text-sm opacity-50",children:l(r.price)})})]},r._id)),t.jsxs("tr",{children:[t.jsx("td",{}),t.jsx("td",{}),t.jsx("td",{className:"text-xl",children:" Total: "}),t.jsx("td",{children:t.jsx("h3",{className:"text-xl text-secondary",children:l(e.reduce((r,n)=>r+n.quantity*n.price,0))})})]})]}),t.jsx("tfoot",{children:t.jsxs("tr",{children:[t.jsx("th",{}),t.jsx("th",{}),t.jsx("th",{children:t.jsx("button",{className:"btn btn-gradient-blue",onClick:()=>s(i()),children:"Reset cart"})}),t.jsx("th",{children:t.jsx("button",{className:"w-20 btn btn-gradient-blue",onClick:a,children:"Pay"})})]})})]})})})},C=()=>{const{cart:e,setCart:s}=j();return e.length?t.jsx(w,{cart:e,setCart:s}):t.jsx("div",{className:"mt-5",children:t.jsx(u,{message:"Your cart is empty :("})})};export{C as default};
